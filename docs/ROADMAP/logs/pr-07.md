# PR #07 Log (append-only)

## Scope
- BSN key versioning + crypto lifecycle hardening.
- Persistencia de BSN con `key_id` + `ciphertext`.
- Compatibilidad con payload legado `bsn_encrypted`.
- Rutina de re-encrypt para rotación de llaves.

## Assumption
- El roadmap no expone una etiqueta textual "PR #07" en el artefacto extraído.
- Se toma como siguiente alcance mínimo el gate técnico de key versioning de BSN (en v9 aparece mapeado como PR #8A), ejecutado en secuencia como PR #07 para mantener continuidad.

## Changed files
- `supabase/migrations/005_bsn_key_versioning.sql`
- `src/lib/security/encryption.ts`
- `src/app/api/cases/draft/route.ts`
- `src/types/database.ts`
- `src/lib/mock-data.ts`
- `scripts/bsn-reencrypt.mjs`
- `tests/encryption-roundtrip.test.mjs`
- `package.json`

## Publish attempt
- 2026-03-01 15:42:50 UTC
- Estado: OFFLINE PARK (GIT_BLOCKED)
- Comando fallido: git push -u origin feat/roadmap-v9-pr07-bsn-key-versioning
- Error exacto final: fatal: unable to access 'https://github.com/andresbedoya22-ctrl/FinTax/': Failed to connect to github.com port 443 after 58 ms: Could not connect to server
- Retry ladder aplicado: 3 intentos (2s/5s/10s) + 1 trace attempt (GIT_TRACE, GIT_TRACE_CURL).
- Comandos manuales cuando conecte:
  - git push -u origin feat/roadmap-v9-pr07-bsn-key-versioning
  - gh pr create --base main --head feat/roadmap-v9-pr07-bsn-key-versioning --title PR#07:BSN-key-versioning+crypto-lifecycle --body-file .github/pull_request_template.md
  - gh pr merge <PR_NUMBER> --squash --delete-branch
